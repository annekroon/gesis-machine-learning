% !TeX document-id = {f19fb972-db1f-447e-9d78-531139c30778}
% !BIB program = biber
%\documentclass[handout]{beamer}
\documentclass[compress]{beamer}
\usepackage[T1]{fontenc}
\usepackage{pifont}
\usetheme[block=fill,subsectionpage=progressbar,sectionpage=progressbar]{metropolis} 

\usepackage{wasysym}
\usepackage{etoolbox}
\usepackage[utf8]{inputenc}

\usepackage{threeparttable}
\usepackage{subcaption}

\usepackage{tikz-qtree}
\setbeamercovered{still covered={\opaqueness<1->{5}},again covered={\opaqueness<1->{100}}}


\usepackage{listings}

\lstset{
	basicstyle=\scriptsize\ttfamily,
	columns=flexible,
	breaklines=true,
	numbers=left,
	%stepsize=1,
	numberstyle=\tiny,
	backgroundcolor=\color[rgb]{0.85,0.90,1}
}



\lstnewenvironment{lstlistingoutput}{\lstset{basicstyle=\footnotesize\ttfamily,
		columns=flexible,
		breaklines=true,
		numbers=left,
		%stepsize=1,
		numberstyle=\tiny,
		backgroundcolor=\color[rgb]{.7,.7,.7}}}{}


\lstnewenvironment{lstlistingoutputtiny}{\lstset{basicstyle=\tiny\ttfamily,
		columns=flexible,
		breaklines=true,
		numbers=left,
		%stepsize=1,
		numberstyle=\tiny,
		backgroundcolor=\color[rgb]{.7,.7,.7}}}{}


\usepackage[american]{babel}
\usepackage{csquotes}
\usepackage[style=apa, backend = biber]{biblatex}
\DeclareLanguageMapping{american}{american-UoN}
\addbibresource{../../literature.bib}
\renewcommand*{\bibfont}{\tiny}

\usepackage{tikz}
\usetikzlibrary{shapes,arrows,matrix}
\usepackage{multicol}

\usepackage{subcaption}

\usepackage{booktabs}
\usepackage{graphicx}

\graphicspath{{../../pictures/}}

\makeatletter
\setbeamertemplate{headline}{%
	\begin{beamercolorbox}[colsep=1.5pt]{upper separation line head}
	\end{beamercolorbox}
	\begin{beamercolorbox}{section in head/foot}
		\vskip2pt\insertnavigation{\paperwidth}\vskip2pt
	\end{beamercolorbox}%
	\begin{beamercolorbox}[colsep=1.5pt]{lower separation line head}
	\end{beamercolorbox}
}
\makeatother

\setbeamercolor{section in head/foot}{fg=normal text.bg, bg=structure.fg}



\newcommand{\question}[1]{
	\begin{frame}[plain]
	\begin{columns}
		\column{.3\textwidth}
		\makebox[\columnwidth]{
			\includegraphics[width=\columnwidth,height=\paperheight,keepaspectratio]{../pictures/mannetje.png}}
		\column{.7\textwidth}
		\large
		\textcolor{orange}{\textbf{\emph{#1}}}
	\end{columns}
\end{frame}}

\newcommand{\instruction}[1]{\emph{\textcolor{gray}{[#1]}}}


\title[Big Data and Automated Content Analysis]{\textbf{A Practical Introduction to Machine Learning in Python} \\Day 1 - Monday  Morning\\ »Introduction«}
\author[Damian Trilling, Anne Kroon]{Damian Trilling \\ Anne Kroon \\ ~ \\ \footnotesize{d.c.trilling@uva.nl, @damian0604 \\a.c.kroon@uva.nl, @annekroon} \\}
\date{September 19, 2022}
\institute[Gesis]{Gesis}

\begin{document}


\tikzstyle{block} = [rectangle, draw, fill=blue!20, 
text width=5em, text centered, rounded corners, minimum height=4em]
\tikzstyle{line} = [draw]
\tikzstyle{pijltje} = [draw, -latex']
\tikzstyle{cloud} = [draw, ellipse,fill=red!20, node distance=3cm,
minimum height=2em, text width=4em, text centered,]




\begin{frame}{}
\titlepage
\end{frame}

\begin{frame}{Today}
\tableofcontents
\end{frame}


\begin{frame} 
All course materials can be found at\ldots \\
~~~~~~~~\url{https://github.com/annekroon/gesis-machine-learning/fall-2022}
\end{frame}

\section{Introducing\ldots}
\subsection{\ldots the people}

\begin{frame} 
Introducing\ldots \\
~~~~~~~~\ldots the people
\end{frame}


\begin{frame}{Introducing\ldots} {\huge{Damian}} \small{} 

\begin{columns}
	\column{.3\textwidth}
	\makebox[\columnwidth]{
		\includegraphics[width=\columnwidth,height=\paperheight,keepaspectratio]{../pictures/damian.jpg}}
	\column{.7\textwidth}
	dr. Damian Trilling \\
	Associate Professor Political Communication \& Journalism \\
	\begin{itemize}
		%\item Studied Communication Science in M\"unster and at the VU 2003--2009
		%\item PhD candidate @ ASCoR 2009--2012
		\item interested in political communication and journalism in a changing media environment and in innovative (digital, large-scale, computational) research methods
	\end{itemize}
	@damian0604 \textbar d.c.trilling@uva.nl \textbar \url{www.damiantrilling.net} 
\end{columns}
\end{frame}

\begin{frame}{Introducing\ldots} {\huge{Anne}} \small{} 
\begin{columns}[] \column{.3\textwidth} \makebox[\columnwidth]{ \includegraphics[width=\columnwidth,height=\paperheight,keepaspectratio]{../pictures/anne.jpg}} \column{.7\textwidth} dr. Anne Kroon \\ 
Assistant Professor Corporate Communication
\begin{itemize} 
	%\item Studied Journalism and Communication,  2006 - 2013
	%\item PhD candidate corporate communication at ASCoR (University of Amsterdam), 2014 - 2017
	\item Research focus on biased AI in recruitment, and media bias regarding minorities
	\item text analysis using automated approaches, word embeddings
\end{itemize} @annekroon \textbar a.c.kroon@uva.nl  \textbar \url{http://www.uva.nl/profiel/k/r/a.c.kroon/a.c.kroon.html} 
\end{columns} 
\end{frame}


\begin{frame}{Introducing\ldots}
{\huge{You}}
\small{}
\begin{columns}
\column{.3\textwidth}
\makebox[\columnwidth]{
\includegraphics[width=\columnwidth,height=\paperheight,keepaspectratio]{../pictures/mannetje.png}}
\column{.7\textwidth}
Your name?\\
Your background?\\
Your reason to follow this course?\\
Do you have a dataset you are working on?
\end{columns}
\end{frame}

\begin{frame}{Short poll}

Do you need
\begin{enumerate}[a]
	\item an intro
	\item a brief refresher
	\item nothing
\end{enumerate}

on

\begin{enumerate}[i]
	\item datatypes (int, float, string, lists, dictionaries)
	\item control flow statements (for, if, try/except)
	\item ways to run your code (notebooks vs IDE's vs text editors)
\end{enumerate}
?

\emph{We will try do adapt today's programme to your needs!}

\end{frame}

\section{Python: A language, not a program}


\begin{frame}[plain]
\makebox[\columnwidth]{
\includegraphics[width=\columnwidth,height=\paperheight,keepaspectratio]{../pictures/knitting.jpg}}
\footnotesize{An algorithm in a language that's a bit harder (I think) than Python}
\end{frame}



\begin{frame}{Python}
\begin{block}{What?}<1->
\begin{itemize}
\item A language, not a specific program
\item Huge advantage: flexibility, portability
\item One of \emph{the} languages for data analysis. \tiny{(The other one is R.)}
\onslide<2>{ \\\tiny{But Python is more flexible---the original version of Dropbox was written in Python. Some people say: R for numbers, Python for text and messy stuff.}}
\end{itemize}
\end{block}

\begin{block}{Which version?}<3->
Anne and Damian use Python 3.8. Probably everything >3.6 will work, even though slight code modifications may be necesary. \\ 
\end{block}
\end{frame}






\begin{frame}[plain]
\begin{tikzpicture}[node distance = 3cm, auto]
\node [cloud] (retrieve) {retrieve};
\node [cloud, right of=retrieve] (process) {process and/or enrich};
\node [cloud, right of=process] (analyze) {analyze\\ explain\\ predict};
\node [cloud, right of=analyze] (visualize) {communi-cate};


\path [pijltje] (retrieve)--(process);
\path [pijltje] (process)--(analyze);
\path [pijltje] (analyze)--(visualize);


\node [block, below of = retrieve] (retrievetech) {files\\ APIs\\ scraping};
\node [block, below of= process] (processtech) {NLP\\ sentiment\\ LDA\\ SML};
\node [block, below of=analyze] (analyzetech) {group comparisons; statistical tests and models};
\node [block, below of=visualize] (visualizetech) {visualizations and summary tables};


\path [pijltje] (retrievetech)--(processtech);
\path [pijltje] (processtech)--(analyzetech);
\path [pijltje] (analyzetech)--(visualizetech);


\node [block, below of = retrievetech, fill=green!20] (retrievepython) {glob\\ json \& csv\\ requests\\ lxml\\ \ldots};

\node [block, below of = processtech, fill=green!20] (processpython) {nltk\\ pattern \\ vader \\ gensim\\ scikit-learn \ldots};

\node [block, below of = analyzetech, fill=green!20] (analyzepython) {numpy/scipy\\ pandas\\ statsmodels\\ \ldots};

\node [block, below of = visualizetech, fill=green!20] (visualizepython) {pandas\\ matplotlib\\ seaborn\\ pyldavis\\ \ldots};

\path [line, dashed] (retrieve)--(retrievetech);
\path [line, dashed] (process)--(processtech);
\path [line, dashed] (analyze)--(analyzetech);
\path [line, dashed] (visualize)--(visualizetech);

\path [line, dashed] (retrievetech)--(retrievepython);
\path [line, dashed] (processtech)--(processpython);
\path [line, dashed] (analyzetech)--(analyzepython);
\path [line, dashed] (visualizetech)--(visualizepython);
\end{tikzpicture}
\end{frame}

\subsection{A good workflow}
\begin{frame}
	A good workflow
\end{frame}


\begin{frame}{Maximize transparency}
\begin{block}{Maximizing transparency of code and data}
	\begin{itemize}[<+->]
		\item Use openly accessible repository (e.g., Github)
		\item Store and preserve (pseudonymised) data at a secure environment (e.g., OSF)
		\item Create reusable workflows 
	\end{itemize}
\end{block}
\pause
\begin{exampleblock}{Advantages}
	\begin{itemize}[<+->]
		\item Reusable data and code
		\item Efficiency and credibility 
		\item Recognition of tools and data
	\end{itemize}
\end{exampleblock}

\end{frame}	

\subsection{Clean, high-quality code}
\begin{frame}{Develop components separately}
	\begin{block}{One script for downloading the data, one script for analyzing}
		\begin{itemize}[<+->]
			\item Avoids waste of resources (e.g., unnecessary downloading multiple times)
			\item Makes it easier to re-use your code or apply it to other data
		\end{itemize}
	\end{block}
\pause
\begin{block}{Start small, then scale up}
	\begin{itemize}[<+->]
		\item Take your plan and solve \textit{one} problem at a time (e.g., parsing a review page; or getting the URLs of all review pages)
		\item (for instance, by using functions [next slides])
	\end{itemize}
\end{block}

\end{frame}	

\begin{frame}{Develop components separately}
	\begin{block}{If you copy-paste code, you are doing something wrong}
		\begin{itemize}[<+->]
			\item Write loops!
			\item If something takes more than a couple of lines, write a function!
		\end{itemize}
	\end{block}
\end{frame}

\begin{frame}[plain, fragile]
Copy-paste approach\\ (ugly, error-prone, hard to scale up)
\begin{lstlisting}
allreviews = []

response = requests.get(`http://xxxxx')
tree =  fromstring(response.text)
reviewelements = tree.xpath(`//div[@class="review"]')
reviews = [e.text for e in reviewelements]
allreviews.extend(reviews)

response = requests.get(`http://yyyyy')
tree =  fromstring(response.text)
reviewelements = tree.xpath(`//div[@class="review"]')
reviews = [e.text for e in reviewelements]
allreviews.extend(reviews)
\end{lstlisting}
\end{frame}


\begin{frame}[plain, fragile]
Better: for-loop\\ (easier to read, less error-prone, easier to scale up (e.g., more URLs, read URLs from a file or existing list)
\begin{lstlisting}
allreviews = []

urls = [`http://xxxxx', `http://yyyyy']

for url in urls:
    response = requests.get(url)
    tree =  fromstring(response.text)
    reviewelements = tree.xpath(`//div[@class="review"]')
    reviews = [e.text for e in reviewelements]
    allreviews.extend(reviews)
\end{lstlisting}
\end{frame}


\begin{frame}[plain, fragile]
Even better: for-loop with functions\\ (main loop is easier to read, function can be re-used in multiple contexts)
\begin{lstlisting}
def getreviews(url):
    response = requests.get(url)
    tree =  fromstring(response.text)
    reviewelements = tree.xpath(`//div[@class="review"]')
    return [e.text for e in reviewelements]


urls = [`http://xxxxx', `http://yyyyy']

allreviews = []

for url in urls:
    allreviews.extend(getreviews(url))
\end{lstlisting}
\end{frame}

\subsection{Exercise}
\begin{frame}{Exercises}
\begin{block}{Did you pass?}
	\begin{itemize}
		\item Think of a way to determine for a list of  grades whether they are a pass (>5.5) or fail.
		\item Can you make that program robust enough to handle invalid input (e.g., a grade as 'ewghjieh')?
		\item How does your program deal with impossible grades (e.g., 12 or -3)?
		\item \ldots
	\end{itemize}
\end{block}
\end{frame}

\subsection{datatypes}
\begin{frame}{Datatypes}
\begin{block}{Low-level: Native python datatypes}
	\begin{itemize}[<+->]
		\item Booleans, integers, floats, strings, bytes, byte arrays
		\item Lists, typles, sets, dictionaries
	\end{itemize}
\end{block}
\pause
\begin{exampleblock}{Advantages }
	\begin{itemize}[<+->]
		\item fast, flexible
		\item allows for nested, unstructured data 
	\end{itemize}
\end{exampleblock}
\pause
\begin{alertblock}{Disadvantages }
	\begin{itemize}[<+->]
		\item can be more cumbersome: e.g., inserting a column
		\item less consistency checks
	\end{itemize}
\end{alertblock}
\end{frame}


\begin{frame}{Datatypes}
\begin{block}{Higher-level: importing modules}
	\begin{itemize}[<+->]
		\item e.g., numpy, pandas, seaborn 
	\end{itemize}
\end{block}
\pause
\begin{exampleblock}{Advantages}
	\begin{itemize}[<+->]
		\item useful convenience functionality, works very intuitively (for tabular data)
		\item easy, allows for pretty visualization
	\end{itemize}
\end{exampleblock}
\pause
\begin{alertblock}{Disadvantages }
	\begin{itemize}[<+->]
		\item not suited for one-dimensional or messy / deeply nested data
		\item when your data is very large (machine learning!!)
	\end{itemize}
\end{alertblock}
\end{frame}

\begin{frame}{Datatypes in this course}
In this week, we will mainly work with lower-level datatypes (as opposed to, for instance, pandas dataframes)
\begin{itemize}[<+->]
	\item Often, ML algorithms require native data types as input (i.e., lists, genertors)
	\item We have to seriously consider memory:
	\item Maybe size does not apply to your project yet, but in the future you might want to scale up. 
\end{itemize}	
\end{frame}

\subsection{Generators}
\begin{frame}{Generators}
\begin{block}{Generators}
	\begin{itemize}[<+->]
		\item We will work with \textit{generators} to deal with memory issues
		\item Generators behave like iterators: loops through elements of an object. 
	\end{itemize}
\end{block}
\pause
\begin{exampleblock}{Behavior of a generator}
	\begin{itemize}[<+->]
		\item Does not hold results in memory
		\item Only computes results at the moment you need them (i.e. lazy')
		\item You can only loop over your object ONCE.
	\end{itemize}
\end{exampleblock}
\end{frame}

\begin{frame}[plain, fragile]
Creating generators: Example 1 
\begin{lstlisting}
def my_generator(my_list):	
    for i in my_list:
        yield i
example_list = [1, 2, 3, 4]
gen1 = my_generator(example_list)        
next(gen1)
\end{lstlisting}
This will return:
\begin{lstlisting}
1
\end{lstlisting}
\end{frame}


\begin{frame}[plain, fragile]
Creating generators: Example 2 (shorter)
\begin{lstlisting}
my_list = [1,2,3,4]
gen = (i for i in my_list)
\end{lstlisting}
\end{frame}


\subsection{Scaling up}
\begin{frame}{Scaling up}
When considering datatypes, consider re-usability, scalability
	\begin{itemize}
		\item Use functions and classes to make code more readable and re-usable
		\item Avoid re-calculating values
		\item Think about how to minimize memory usage (e.g., Generators)
		\item Do not hard-code values, file names, etc., but take them as arguments
	\end{itemize}	
\end{frame}


\begin{frame}{Make it robust}
You cannot foresee every possible problem.\\
Most important: Make sure your program does not fail and loose all data just because something goes wrong at case 997/1000.
	\begin{itemize}
		\item Use \texttt{try/except} to explicitly tell the program how to handle errors
		\item Write data to files (or database) in between
		\item Use \texttt{assert len(x) == len(y}) for sanity checks
	\end{itemize}	
\end{frame}

\subsection{data storage}
\begin{frame}{Storing data}
\begin{block}{Use of databases}
	Storing data
	\begin{itemize}
		\item We can store our data in files (often, one CSV or JSON file)
		\item But that's not very efficient if we have large datasets; especially if we want to select subsets later on
		\item SQL-databases to store tables (e.g., MySQL)
		\item NoSQL-databases to store less structured data (e.g., JSON with unknown keys) (e.g., MongoDB, ElasticSearch)
		\item $\Rightarrow$ \tiny{Günther, E., Trilling, D., \& Van de Velde, R.N. (2018). But how do we store it? (Big) data architecture in the social-scientific research process. In:\textit{ Stuetzer, C.M., Welker, M., \& Egger, M. (eds.): Computational Social Science in the Age of Big Data. Concepts, Methodologies, Tools, and Applications}. Cologne, Germany: Herbert von Halem.}
	\end{itemize}
\end{block}
\end{frame}

\begin{frame}{Storing data}
\makebox[\linewidth]{
\includegraphics[width=\paperwidth,height=\paperheight,keepaspectratio]{../pictures/guenteretal_fig1}}
\end{frame}

\begin{frame}{From retrieved data to enriched data}
\makebox[\linewidth]{
\includegraphics[width=\paperwidth,height=\paperheight,keepaspectratio]{../pictures/guentheretal_fig3}}
\end{frame}


\section{Looking forward}
\subsection{And now you... }
\begin{frame}[plain]{}
Looking forward\\
\textbf{Try to fill in the blanks for your personal CSS project}
\end{frame}


\begin{frame}[plain]
	\begin{tikzpicture}[node distance = 3cm, auto]
	\node [cloud] (retrieve) {retrieve};
	\node [cloud, right of=retrieve] (process) {process and/or enrich};
	\node [cloud, right of=process] (analyze) {analyze\\ explain\\ predict};
	\node [cloud, right of=analyze] (visualize) {communi-cate};
	
	
	\path [pijltje] (retrieve)--(process);
	\path [pijltje] (process)--(analyze);
	\path [pijltje] (analyze)--(visualize);
	
	
	\node [block, below of = retrieve] (retrievetech) {?};
	\node [block, below of= process] (processtech) {?};
	\node [block, below of=analyze] (analyzetech) {?};
	\node [block, below of=visualize] (visualizetech) {?};
	
	
	
	\path [pijltje] (retrievetech)--(processtech);
	\path [pijltje] (processtech)--(analyzetech);
	\path [pijltje] (analyzetech)--(visualizetech);
	
	
	\node [block, below of = retrievetech, fill=green!20] (retrievepython) {?};
	
	\node [block, below of = processtech, fill=green!20] (processpython) {?};
	
	\node [block, below of = analyzetech, fill=green!20] (analyzepython) {?};
	
	\node [block, below of = visualizetech, fill=green!20] (visualizepython) {?};
	
	
	
	
	
	\path [line, dashed] (retrieve)--(retrievetech);
	\path [line, dashed] (process)--(processtech);
	\path [line, dashed] (analyze)--(analyzetech);
	\path [line, dashed] (visualize)--(visualizetech);
	
	
	
	\path [line, dashed] (retrievetech)--(retrievepython);
	\path [line, dashed] (processtech)--(processpython);
	\path [line, dashed] (analyzetech)--(analyzepython);
	\path [line, dashed] (visualizetech)--(visualizepython);
	\end{tikzpicture}
\end{frame}



\begin{frame}[plain]
Long story short:

\textbf{Don't forget to plan the bigger picture}

We will focus on machine learning this week. But for each technique we cover, think about how it fits in \emph{your} workflow.

\pause

\ldots and now lets get started!

\end{frame}

\section[The ACA toolkit]{The Automated Content Analysis toolkit}
\begin{frame}{}
Types of Automated Content Analysis
\end{frame}

\subsection*{Top-down vs. bottom-up}

%{\setbeamercolor{background canvas}{bg=black}
\begin{frame}[plain]
\makebox[\linewidth]{
\includegraphics[width=\paperwidth,height=\paperheight,keepaspectratio]{../pictures//boumanstrilling2016_.png}}
\end{frame}
%}

\begin{frame}{Some terminology }
\begin{columns}[t]
\column{.5\textwidth}

\begin{block}<1-4>{Supervised machine learning}
You have a dataset with both predictor and outcome (independent and dependent variables; features and labels) --- a \emph{labeled} dataset.
\onslide<2>{
	\footnotesize{Think of regression: You measured \texttt{x1}, \texttt{x2}, \texttt{x3} and you want to predict \texttt{y}, which you also measured}}
\end{block}

\column{.5\textwidth}

\begin{block}<3->{Unsupervised machine learning}
You have no labels. \onslide<4>{(\footnotesize{You did not measure \texttt{y})}}\\
\onslide<5>{\textbf{Again, you already know some techniques to find out how \texttt{x1}, \texttt{x2},\ldots \texttt{x\_i} co-occur from other courses:} \begin{itemize}
		\item Principal Component Analysis (PCA)
		\item Cluster analysis
		\item \ldots
	\end{itemize}
}
\end{block}

\end{columns}

\end{frame}


\section{Final}

\begin{frame}{This afternoon}
\begin{block}{Getting started}
	Getting started with the IMBD dataset
\end{block}
\end{frame}



\section{Backupslides basics}

\begin{frame}[plain]
\centering
\huge
Backup slides in case we need to do more fundamentals
\end{frame}


\input{basicsofpython}


\end{document}

